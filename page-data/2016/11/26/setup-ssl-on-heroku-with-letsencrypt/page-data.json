{"componentChunkName":"component---src-templates-blog-post-js","path":"/2016/11/26/setup-ssl-on-heroku-with-letsencrypt","result":{"data":{"site":{"siteMetadata":{"title":"Blog","author":"Nick Ma","siteUrl":"https://nickma.com"}},"markdownRemark":{"id":"740d524b-f4b8-5f0b-b2f9-9c45a820bf74","excerpt":"So this weekend I had some time to help out on a opensource project manage by some awesome Toronto folks. The steps are as follows: figure out how to setup the…","htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So this weekend I had some time to help out on a opensource project manage by some awesome Toronto folks."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The steps are as follows:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"figure out how to setup the app for SSL or enforce SSL."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"how to test it properly without downtime? because SSL is tied to a domain this mean the quickest way to test is on production."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"figure out how heroku SSL solutions."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Enforce SSL and Testing"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In Rails the way that SSL is enforced is set in a config file, this would be the following path "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"config/environments/production.rb"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ruby"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"\nconfig"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"force_ssl "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","boolean"]},"children":[{"type":"text","value":"true"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# This is required or the host server will send headers telling us its from the *.herokuapp.com domain"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# subsequently, this will cause the SSL certs registered for our private DNS address to fail."}]},{"type":"text","value":"\nconfig"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"action_controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"default_url_options "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"{"}]},{"type":"text","value":" host"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"www.example.org\""}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"}"}]},{"type":"text","value":"\nconfig"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"action_controller"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"text","value":"asset_host "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"www.example.org\""}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"."}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By default SSL is an optional protocol to the webapp, a user can direct to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://"}]},{"type":"text","value":" or "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"https://"}]},{"type":"text","value":", but websites also need a DNS change to redirect "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://"}]},{"type":"text","value":" -> "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"https://"}]},{"type":"text","value":".\nFor most servers we also need to enable the endpoint/port, because regular web traffic routes on "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":":80"}]},{"type":"text","value":", but https requires "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":":443"}]},{"type":"text","value":" by convention. Rails will perform the redirect when "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"force"}]},{"type":"text","value":"ssl_ is set to true."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In Heroku… An alternative SSL implementation is available via the SSL Endpoint add-on. The SSL Endpoint add-on is only recommended if you need to support legacy browser clients which do not support SNI. It also costs another $20/mo to enable."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since most of this projects users won’t be using legacy browsers, we drop the clunky SSL Endpoint and go with the SNI version. Much faster and friendlier!\nDon’t worry too much about the distinction, but if you must here is a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Server_Name_Indication"},"children":[{"type":"text","value":"wiki link"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now to allow this functionality Heroku requests that you direct your app’s DNS to a specific DNS name, which then resolves your application server so that it hits your server with an internal IP.\nWhen you just hit the app at "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"example.heroku.com"}]},{"type":"text","value":", you are hitting the app at the top level heroku DNS router."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$> heroku domains\n=== example Heroku Domain\nexample.herokuapp.com\n\n=== example Custom Domains\nDomain Name       DNS Target\n────────────────  ──────────────────────────────\nexample.me      example.me.herokudns.com\nwww.example.me  www.example.me.herokudns.com"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This is required or the host server will route from *.herokuapp.com domain subsequently, this will cause the SSL certs registered for our private DNS address to fail."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":" dig www.example.org\n\n ; <<>> DiG 9.10.3-P4-Ubuntu <<>> www.if-me.org\n ;; global options: +cmd\n ;; Got answer:\n ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 23689\n ;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 4, ADDITIONAL: 1\n\n ;; OPT PSEUDOSECTION:\n ; EDNS: version: 0, flags:; udp: 1280\n ;; QUESTION SECTION:\n ;www.example.org.            IN  A\n\n ;; ANSWER SECTION:\n www.example.org.     1800    IN  CNAME   example.herokuapp.com.\n example.herokuapp.com.    300 IN  CNAME   us-east-1-a.route.herokuapp.com.\n us-east-1-a.route.herokuapp.com. 50 IN A   1.2.188.105\n\n ;; AUTHORITY SECTION:\n herokuapp.com.     400 IN  NS  ns-505.awsdns-63.com.\n herokuapp.com.     400 IN  NS  ns-662.awsdns-18.net.\n herokuapp.com.     400 IN  NS  ns-1378.awsdns-44.org.\n herokuapp.com.     400 IN  NS  ns-1624.awsdns-11.co.uk.\n\n ;; Query time: 218 msec\n ;; SERVER: 127.0.1.1#53(127.0.1.1)\n ;; WHEN: Sun Nov 27 00:52:12 EST 2016\n ;; MSG SIZE  rcvd: 256"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When your "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ANSWER SECTION"}]},{"type":"text","value":" is a "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"CNAME"}]},{"type":"text","value":" redirect to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"example.herokuapp.com"}]},{"type":"text","value":", the DNS server tells the browser that this is "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"\\*.herokuapp.com"}]},{"type":"text","value":".\nSince your SSL is registered for "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"www.example.com"}]},{"type":"text","value":" and not "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"\\*.herokuapp.com"}]},{"type":"text","value":"!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You need to change your DNS to point to the topmost DNS resolver as output by your "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"heroku domains"}]},{"type":"text","value":" command.\nThen your DNS resolution will now return the correct "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"www.example.com"}]},{"type":"text","value":" metadata for the SSL Cert to be validated."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"; <<>> DiG 9.10.3-P4-Ubuntu <<>> www.example.org\n;; global options: +cmd\n;; Got answer:\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 43572\n;; flags: qr rd ra; QUERY: 1, ANSWER: 9, AUTHORITY: 4, ADDITIONAL: 1\n\n;; OPT PSEUDOSECTION:\n; EDNS: version: 0, flags:; udp: 1280\n;; QUESTION SECTION:\n;www.example.org.      IN  A\n\n;; ANSWER SECTION:\nwww.example.org.   1800    IN  CNAME   www.example.org.herokudns.com.\nwww.example.org.herokudns.com. 60 IN   A   54.243.119.83\nwww.example.org.herokudns.com. 60 IN   A   54.243.91.166\nwww.example.org.herokudns.com. 60 IN   A   54.561.252.234\nwww.example.org.herokudns.com. 60 IN   A   50.19.93.247\nwww.example.org.herokudns.com. 60 IN   A   54.565.193.561\nwww.example.org.herokudns.com. 60 IN   A   54.565.563.184\nwww.example.org.herokudns.com. 60 IN   A   54.235.135.158\nwww.example.org.herokudns.com. 60 IN   A   54.235.212.238\n\n;; AUTHORITY SECTION:\nherokudns.com.      123094  IN  NS  ns-44.awsdns-05.com.\nherokudns.com.      123094  IN  NS  ns-955.awsdns-55.net.\nherokudns.com.      123094  IN  NS  ns-1260.awsdns-29.org.\nherokudns.com.      123094  IN  NS  ns-1672.awsdns-17.co.uk.\n\n;; Query time: 69 msec\n;; SERVER: 127.0.1.1#53(127.0.1.1)\n;; WHEN: Sun Nov 27 00:57:16 EST 2016\n;; MSG SIZE  rcvd: 353"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Check #1."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To test SSL we don’t need to enforce SSL to test that it works, we can in theory setup SSL certs but don’t enforce it, this way\nour app can still stay in production to serve regular http request without anything breaking."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"All we need to do is just hit it with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"https://"}]},{"type":"text","value":" and see if the cert breaks or not. The normal traffic will just flow from "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://"}]},{"type":"text","value":" without an issues."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Check #2."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"SSL options"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Last step is to browse through the SSL options we are given."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The initial options are given to me with a Heroku plugin called:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ExpediateSSL at $15/month. This gives you a SSL cert along with automagically integrating all the settings. Though it is a bit more black box."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Lets Encrypt + Heroku SSL SNI"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ExpediateSSL most likely works by similar methods, as they have a video about setup in "},{"type":"element","tagName":"a","properties":{"href":"https://www.youtube.com/watch?v=OcyR7Yus4pc"},"children":[{"type":"text","value":"3 minute setup"}]},{"type":"text","value":", but some issues made it not work, so I checked out the alternative setup.\nThe issue seems to be that, expediateSSL seems to require the SSL-Endpoint, so in the note on the documentation."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"NOTE: Expedited SSL works with your Heroku SSL Endpoint. If one is not already a part of your application, one will be added at its base monthly cost."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In total, the expediated SSL + SSL-Endpoint runs at an additional $35/mo, since the app is still in the hobby phase, we can cut that cost with the letsencrypt method, until the day we actually need to support legacy browsers and have automated cert updates to CloudFront."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With a bit more doc reading (I am a weird person, I like reading docs while listening to "},{"type":"element","tagName":"a","properties":{"href":"http://www.indieshuffle.com/playlists/readingdocs-115588/"},"children":[{"type":"text","value":"music"}]},{"type":"text","value":".)\nWe also have the service provided by letsencrypt, "},{"type":"element","tagName":"a","properties":{"href":"https://letsencrypt.org/"},"children":[{"type":"text","value":"Let’s Encrypt"}]},{"type":"text","value":" is a free, automated, and open Certificate Authority.\nTheir setup is a bit more involved, but it is well worth it! Plus this SSL knowledge can then be applied to every app idea you have thus forth.\nPersonally I’m of the mentality to learn it the hard way, as infrastructure is black box most of the time. Gotta show that all the wasted time on reading tech docs isn’t actually a waste!"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since Let’s Encrypt is backed by Chrome, Mozilla, Akamai\nand other major browser and CDN vendors, we can have a higher confidence that a browser update won’t redact our SSL certs. e.g. "},{"type":"element","tagName":"a","properties":{"href":"https://sslmate.com/blog/post/ct_redaction_in_chrome_53"},"children":[{"type":"text","value":"Chrome 53 rejects Chase online bankings Symantec SSL Certs."}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A sample of the setup I used is found on medium.com on a "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@franxyzxyz/setting-up-free-https-with-heroku-ssl-and-lets-encrypt-80cf6eac108e#.v9azmm96o"},"children":[{"type":"text","value":"letsencrypt example with heroku post"}]},{"type":"text","value":",\nthis tut meshes well with a sample that is tailored to rails apps "},{"type":"element","tagName":"a","properties":{"href":"http://collectiveidea.com/blog/archives/2016/01/12/lets-encrypt-with-a-rails-app-on-heroku"},"children":[{"type":"text","value":"letsencrypt with heroku and rails"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Though essentially, the following steps were used."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$> sudo apt-get install letsencrypt\n\n# Hit the above links for pictures!\n$> sudo letsencrypt certonly  --manual\n...\nMake sure your web server displays the following content at\nhttp://www.example.com/.well-known/acme-challenge/xxxxxxxxxxxx-yyyy.zzzzzzzzzzzzzzzzzzz before continuing:\nxxxxxxxxxxxx-yyyy.zzzzzzzzzzzzzzzzzzz\nIf you don’t have HTTP server configured, you can run the following\ncommand on the target server (as root):\nmkdir -p /tmp/certbot/public_html/.well-known/acme-challenge\ncd /tmp/certbot/public_html\nprintf “%s” Gm35kFLiXnNtKT9OAOG_KPZvqMmYYAZU6DN-QRoGclg.s2I4ZV9Ne2CNtczlqXV9uw1ZdB5OSypG_cIdiuT7BwI > .well-known/acme-challenge/Gm35kFLiXnNtKT9OAOG_KPZvqMmYYAZU6DN-QRoGclg\n# run only once per server:\n$(command -v python2 || command -v python2.7 || command -v python2.6) -c \\\n“import BaseHTTPServer, SimpleHTTPServer; \\\ns = BaseHTTPServer.HTTPServer((‘’, 80), SimpleHTTPServer.SimpleHTTPRequestHandler); \\\ns.serve_forever()”\nPress ENTER to continue"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In rails, add these files:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ruby"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# config/routes.rb"}]},{"type":"text","value":"\nget "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'/.well-known/acme-challenge/:id'"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"="}]},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'pages#letsencrypt'"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the controllers, add the following method."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"ruby"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-ruby"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-ruby"]},"children":[{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"class"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","class-name"]},"children":[{"type":"text","value":"PagesController"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","constant"]},"children":[{"type":"text","value":"ApplicationController"}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"def"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","method-definition"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"letsencrypt"}]}]},{"type":"text","value":"\n      "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# use your code here, not mine"}]},{"type":"text","value":"\n      render text"},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":":"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"\"ya6k1edW38z-your-value-here\""}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"end"}]},{"type":"text","value":"\n  "},{"type":"element","tagName":"span","properties":{"className":["token","keyword"]},"children":[{"type":"text","value":"end"}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now deploy your app on heroku, then continue the letsencrypt workflow. An automated agent will hit your server with your domain name just to verify that you own it. The challenge above needs to be returned."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"IMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/www.example.com/fullchain.pem. Your cert will\n   expire on 2016-04-11. To obtain a new version of the certificate in\n   the future, simply run Let's Encrypt again."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"All your certs will live in /etc/letsencrypt/live/www.example.com/*.pem, this directory should be centralized and backed up."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# upload certs to the mothership\n$> sudo heroku certs:add /etc/letsencrypt/live/www.example.com/fullchain.pem"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$> curl -vI https://www.example.com\n\n# boom."}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When you need to upgrade the cert."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo letsencrypt certonly --manual -d www.example.com"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Free certs for all your domains, no $35/mo issues."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When you need to update the cert to match new subdomains"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo letsencrypt certonly --expand -d www.example.com"}]}]}]}],"data":{"quirksMode":false}},"frontmatter":{"title":"Setup SSL on Heroku with letsencrypt and Rails","date":"November 26, 2016","description":"how to setup SSL works with letsencrypt","category":"Tutorial","tags":["Open Source","DevOps"]}}},"pageContext":{"slug":"/2016/11/26/setup-ssl-on-heroku-with-letsencrypt","previous":{"fields":{"slug":"/2016/07/11/trigger-lambda-on-instance-termination"},"frontmatter":{"title":"Trigger Lambda on Instance Termination.","category":"Tutorial","tags":["AWS","lambda"]}},"next":null}},"staticQueryHashes":["2879488385","3128451518","426816048"]}